name: Package NextCloud Server

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  package-code:
    runs-on: arc-runner-nc-fork

    steps:
      - name: Install Git
        run: |
          if ! command -v git &> /dev/null
          then
            echo "Git not found, installing..."
            sudo apt-get update
            sudo apt-get install -y git
          else
            echo "Git is already installed"
          fi

      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          repository: IONOS-Productivity/nc-server
          ref: master

      - name: Package Code
        run: |
          mkdir -p /tmp/nc-server
          cp -r . /tmp/nc-server
          cd /tmp/nc-server
          tar -czvf /tmp/nc-server.tar.gz .
          
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: nc-server-package
          path: /tmp/nc-server.tar.gz
